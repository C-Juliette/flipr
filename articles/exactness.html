<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>On the exactness of permutation tests • psi</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="On the exactness of permutation tests">
<meta property="og:description" content="psi">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">psi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/alternative.html">The alternative hypothesis in permutation testing</a>
    </li>
    <li>
      <a href="../articles/exactness.html">On the exactness of permutation tests</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="exactness_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="exactness_files/htmlwidgets-1.5.3/htmlwidgets.js"></script><script src="exactness_files/plotly-binding-4.9.3/plotly.js"></script><script src="exactness_files/pymjs-1.3.2/pym.v1.min.js"></script><script src="exactness_files/typedarray-0.1/typedarray.min.js"></script><script src="exactness_files/jquery-3.5.1/jquery.min.js"></script><link href="exactness_files/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="exactness_files/crosstalk-1.1.1/js/crosstalk.min.js"></script><link href="exactness_files/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="exactness_files/plotly-main-1.57.1/plotly-latest.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>On the exactness of permutation tests</h1>
            
      
      
      <div class="hidden name"><code>exactness.Rmd</code></div>

    </div>

    
    
<p>In this article, we discuss the exactness property of permutation tests, which is closely related to how <span class="math inline">\(p\)</span>-values are retrieved from the permutations. This article is a summary of the paper by <span class="citation">Phipson and Smyth (2010)</span>.</p>
<div id="traditional-formulation-of-a-statistical-test" class="section level2">
<h2 class="hasAnchor">
<a href="#traditional-formulation-of-a-statistical-test" class="anchor"></a>Traditional formulation of a statistical test</h2>
<p>A statistical test aims at determining whether some observed data can be considered to be strong evidence in favor of a so-called <em>alternative</em> hypothesis <span class="math inline">\(H_a\)</span> compared to a so-called <em>null</em> hypothesis <span class="math inline">\(H_0\)</span>. To do that, a test statistic <span class="math inline">\(T\)</span> is defined such that:</p>
<ul>
<li>its observed value under <span class="math inline">\(H_0\)</span> can be computed once you observed some data;</li>
<li>large values of the statistic are evidence in favor of <span class="math inline">\(H_a\)</span>.</li>
<li>you know (an approximation of) the distribution of <span class="math inline">\(T\)</span> under the null hypothesis, also known as the <strong>null distribution</strong>.</li>
</ul>
<p>Once such a test statistic is available and we observe some data, we can denote by <span class="math inline">\(t_\mathrm{obs}\)</span> the value of the test statistic computed from the observed data and define the so-called <strong>p-value</strong> as the null hypothesis tail probability: <span class="math display">\[ p_\infty = \mathbb{P}_{H_0} \left( T \ge t_\mathrm{obs} \right). \]</span> The p-value <span class="math inline">\(p_\infty\)</span> is by definition uniformly distributed on <span class="math inline">\((0,1)\)</span> under the null hypothesis. Hence, we can define the so-called <strong>significance level</strong> <span class="math inline">\(\alpha \in (0,1)\)</span> and decide to reject <span class="math inline">\(H_0\)</span> in favor of <span class="math inline">\(H_1\)</span> when <span class="math inline">\(p_\infty \le \alpha\)</span>. By doing this, the probability of wrongly rejecting <span class="math inline">\(H_0\)</span>, also known as the probability of type I errors, is simply: <span class="math display">\[ \mathbb{P}_{H_0} \left( p_\infty \le \alpha \right) = \alpha. \]</span> The significance level <span class="math inline">\(\alpha\)</span> therefore matches by design the probability of type I errors, which means that choosing <span class="math inline">\(\alpha\)</span> allows to control the probability of type I errors. We say that the test is <strong>exact</strong>.</p>
<p>When the null distribution of <span class="math inline">\(T\)</span> is not known, you do not have access to <span class="math inline">\(p_\infty\)</span>. A possible solution is then to resort to resampling techniques to approach the null hypothesis. Once you get an approximate null distribution, the question is how do you compute a p-value that provides an exact statistical test. There are two approaches to this problem: the first estimates the true p-value <span class="math inline">\(p_\infty\)</span> from the approximate null distribution while the second proposes an alternative definition of the p-value that can be straightforwardly computed. Let us expand on both approaches.</p>
</div>
<div id="the-two-sample-problem-in-a-permutational-framework" class="section level2">
<h2 class="hasAnchor">
<a href="#the-two-sample-problem-in-a-permutational-framework" class="anchor"></a>The two-sample problem in a permutational framework</h2>
<p>We start with two samples <span class="math inline">\(X_1, \dots, X_{n_x} \stackrel{iid}{\sim} \mathcal{D}(\theta_x)\)</span> and <span class="math inline">\(Y_1, \dots, Y_{n_y} \stackrel{iid}{\sim} \mathcal{D}(\theta_y)\)</span>. We want to know whether the two distributions are the same or not on the basis of the two samples we collected. In this parametric setting, it boils down to testing the following hypotheses: <span class="math display">\[ H_0: \theta_x = \theta_y \quad \mbox{vs} \quad \theta_x \neq \theta_y. \]</span> Let <span class="math inline">\(T\)</span> be a statistic that depends on the two samples which is suited for elucidating this test, i.e.:</p>
<ul>
<li>you can compute its observed value under the null hypothesis once you observed some data;</li>
<li>large values of the statistic are evidence in favor of the alternative hypothesis.</li>
</ul>
<p>Now, for performing the test, one should also know (an approximation of) the distribution of <span class="math inline">\(T\)</span> under the null hypothesis, also known as the <strong>null distribution</strong>, from which the p-value associated to this test can be computed for instance.</p>
<p>If one knows the exact null distribution, then there is no need to resort to permutations. However, if the null distribution is not known, permutations come in handy for approaching it.</p>
<p>The idea is that, under the null hypothesis, the two samples come from the same distribution. Hence, we can pull them together as one big sample of size <span class="math inline">\(n = n_x + n_y\)</span> generated by that common distribution. At this point, we can split the pooled sample into two random subsets of size <span class="math inline">\(n_x\)</span> and <span class="math inline">\(n_y\)</span> respectively, and use them to compute a value of the statistic <span class="math inline">\(T\)</span>. If we repeat many times this splitting strategy, say <span class="math inline">\(m\)</span> times, we end up with <span class="math inline">\(m\)</span> values of the statistic from which we can compute the empirical distribution, known as the <strong>permutation distribution</strong>, which approaches the null distribution.</p>
</div>
<div id="permutation-p-value-as-an-unbiased-estimator-of-p_infty" class="section level2">
<h2 class="hasAnchor">
<a href="#permutation-p-value-as-an-unbiased-estimator-of-p_infty" class="anchor"></a>Permutation p-value as an unbiased estimator of <span class="math inline">\(p_\infty\)</span>
</h2>
<p>Let <span class="math inline">\(t_\mathrm{obs}\)</span> be the value of the statistic computed from the original two samples, <span class="math inline">\(m\)</span> be the number of permutations used to approach the null distribution and <span class="math inline">\(B\)</span> be a random variable that counts the number of test statistic values greater than or equal to <span class="math inline">\(t_\mathrm{obs}\)</span>.</p>
<p>By definition, the random variable <span class="math inline">\(B\)</span> follows a binomial distribution of size <span class="math inline">\(m\)</span> and rate of success <span class="math inline">\(p_\infty\)</span>. Hence, we can define the following <strong>unbiased estimator</strong> of <span class="math inline">\(p_\infty\)</span>: <span class="math display">\[ \widehat{p_\infty} = \frac{B}{m}. \]</span></p>
<p>However, when one uses this estimator of the p-value for the purpose of hypothesis testing, the resulting test is not exact. Let us investigate why.</p>
<p>First, remember that the true p-value <span class="math inline">\(p_\infty\)</span> is a random variable itself, in the sense that its value changes as soon as <span class="math inline">\(t_\mathrm{obs}\)</span> changes i.e. each time the whole experiment is reconducted. Hence, the probability of wrongly rejecting the null hypothesis using <span class="math inline">\(\widehat{p_\infty}\)</span> reads: <span class="math display">\[ \mathbb{P} \left( \widehat{p_\infty} \le \alpha \right) = \int_\mathbb{R} \mathbb{P} \left( \widehat{p_\infty} \le \alpha | p \right) f_{p_\infty}(p) dp = \int_0^1 \mathbb{P} \left( \widehat{p_\infty} \le \alpha | p \right) dp, \]</span> because <span class="math inline">\(p_\infty\)</span> is uniformly distributed on <span class="math inline">\((0,1)\)</span> under the null hypothesis.</p>
<p>Next, notice that <span class="math inline">\(\widehat{p_\infty}\)</span> can only take on a finite set of values <span class="math inline">\(\left\{ 0, \frac{1}{m}, \frac{2}{m}, \dots, \frac{m-1}{m}, 1 \right\}\)</span>. Hence, we have for any <span class="math inline">\(b \in 0, 1, \dots, m\)</span>: <span class="math display">\[ \mathbb{P} \left( \widehat{p_\infty} = \frac{b}{m} \right) = \int_0^1 \mathbb{P} \left( \widehat{p_\infty} = \left. \frac{b}{m} \right| p \right) dp = \int_0^1 \binom{m}{b} p^b (1-p)^{m-b} dp = \frac{1}{m + 1}. \]</span></p>
<p>We can therefore deduce that: <span class="math display">\[ \mathbb{P} \left( \widehat{p_\infty} \le \alpha \right) = \frac{\lfloor m \alpha \rfloor + 1}{m + 1} \neq \alpha. \]</span></p>
<p>The following R code shows graphically that this does not provide an exact test:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.1</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">100</span>, <span class="fl">1000</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">crossing</span><span class="op">(</span><span class="va">alpha</span>, <span class="va">m</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    p <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">m</span> <span class="op">*</span> <span class="va">alpha</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">m</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, 
    mf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"m ="</span>, <span class="va">m</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">alpha</span>, <span class="va">p</span>, color <span class="op">=</span> <span class="va">mf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_abline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Significance level"</span>,
    y <span class="op">=</span> <span class="st">"Probability of wrongly rejecting H0"</span>
  <span class="op">)</span> <span class="op">+</span> 
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">mf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_color_viridis_d</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_y_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">%&gt;%</span> 
  <span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/plotly/reference/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/plotly/reference/hide_legend.html">hide_legend</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">widgetframe</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/widgetframe/man/frameableWidget.html">frameableWidget</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-90e9be0d96c99fe10e5d" style="width:100%;height:432.632880098888px;" class="plotly html-widget"></div>
<script>HTMLWidgets.pymChild = new pym.Child();HTMLWidgets.addPostRenderHandler(function(){
                                setTimeout(function(){HTMLWidgets.pymChild.sendHeight();},100);
                            });</script><script type="application/json" data-for="htmlwidget-90e9be0d96c99fe10e5d">{"x":{"data":[{"x":[0.01,0.02,0.03,0.04,0.05,0.06,0.07,0.08,0.09,0.1],"y":[0.0909090909090909,0.0909090909090909,0.0909090909090909,0.0909090909090909,0.0909090909090909,0.0909090909090909,0.0909090909090909,0.0909090909090909,0.0909090909090909,0.0909090909090909],"text":["alpha: 0.01<br />p: 0.09090909<br />mf: m = 10","alpha: 0.02<br />p: 0.09090909<br />mf: m = 10","alpha: 0.03<br />p: 0.09090909<br />mf: m = 10","alpha: 0.04<br />p: 0.09090909<br />mf: m = 10","alpha: 0.05<br />p: 0.09090909<br />mf: m = 10","alpha: 0.06<br />p: 0.09090909<br />mf: m = 10","alpha: 0.07<br />p: 0.09090909<br />mf: m = 10","alpha: 0.08<br />p: 0.09090909<br />mf: m = 10","alpha: 0.09<br />p: 0.09090909<br />mf: m = 10","alpha: 0.10<br />p: 0.09090909<br />mf: m = 10"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(68,1,84,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(68,1,84,1)"}},"hoveron":"points","name":"m = 10","legendgroup":"m = 10","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.01,0.02,0.03,0.04,0.05,0.06,0.07,0.08,0.09,0.1],"y":[0.0198019801980198,0.0297029702970297,0.0396039603960396,0.0495049504950495,0.0594059405940594,0.0693069306930693,0.0693069306930693,0.0891089108910891,0.099009900990099,null],"text":["alpha: 0.01<br />p: 0.01980198<br />mf: m = 100","alpha: 0.02<br />p: 0.02970297<br />mf: m = 100","alpha: 0.03<br />p: 0.03960396<br />mf: m = 100","alpha: 0.04<br />p: 0.04950495<br />mf: m = 100","alpha: 0.05<br />p: 0.05940594<br />mf: m = 100","alpha: 0.06<br />p: 0.06930693<br />mf: m = 100","alpha: 0.07<br />p: 0.06930693<br />mf: m = 100","alpha: 0.08<br />p: 0.08910891<br />mf: m = 100","alpha: 0.09<br />p: 0.09900990<br />mf: m = 100","alpha: 0.10<br />p: 0.10891089<br />mf: m = 100"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(33,144,140,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(33,144,140,1)"}},"hoveron":"points","name":"m = 100","legendgroup":"m = 100","showlegend":true,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.01,0.02,0.03,0.04,0.05,0.06,0.07,0.08,0.09,0.1],"y":[0.010989010989011,0.020979020979021,0.030969030969031,0.040959040959041,0.050949050949051,0.0609390609390609,0.0699300699300699,0.0809190809190809,0.0909090909090909,0.0999000999000999],"text":["alpha: 0.01<br />p: 0.01098901<br />mf: m = 1000","alpha: 0.02<br />p: 0.02097902<br />mf: m = 1000","alpha: 0.03<br />p: 0.03096903<br />mf: m = 1000","alpha: 0.04<br />p: 0.04095904<br />mf: m = 1000","alpha: 0.05<br />p: 0.05094905<br />mf: m = 1000","alpha: 0.06<br />p: 0.06093906<br />mf: m = 1000","alpha: 0.07<br />p: 0.06993007<br />mf: m = 1000","alpha: 0.08<br />p: 0.08091908<br />mf: m = 1000","alpha: 0.09<br />p: 0.09090909<br />mf: m = 1000","alpha: 0.10<br />p: 0.09990010<br />mf: m = 1000"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(253,231,37,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(253,231,37,1)"}},"hoveron":"points","name":"m = 1000","legendgroup":"m = 1000","showlegend":true,"xaxis":"x3","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045],"y":[0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045],"text":"intercept: 0<br />slope: 1","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045],"y":[0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045],"text":"intercept: 0<br />slope: 1","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045],"y":[0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.0055,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045,0.1045],"text":"intercept: 0<br />slope: 1","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x3","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":37.4194842558133,"r":7.30593607305936,"b":39.6843244384618,"l":54.7945205479452},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,0.328576864535769],"automargin":true,"type":"linear","autorange":false,"range":[0.0055,0.1045],"tickmode":"array","ticktext":["0.025","0.050","0.075","0.100"],"tickvals":[0.025,0.05,0.075,0.1],"categoryorder":"array","categoryarray":["0.025","0.050","0.075","0.100"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","scaleanchor":"y","scaleratio":1,"hoverformat":".2f"},"annotations":[{"text":"Significance level","x":0.5,"y":-0.0196373426241191,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"top","annotationType":"axis"},{"text":"Probability of wrongly rejecting H0","x":-0.0261605783866058,"y":0.5,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-90,"xanchor":"right","yanchor":"center","annotationType":"axis"},{"text":"m = 10","x":0.164288432267884,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"m = 100","x":0.5,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"m = 1000","x":0.835711567732116,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"}],"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.005,0.105],"tickmode":"array","ticktext":["0.000","0.025","0.050","0.075","0.100"],"tickvals":[0,0.025,0.05,0.075,0.1],"categoryorder":"array","categoryarray":["0.000","0.025","0.050","0.075","0.100"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","scaleanchor":"x","scaleratio":1,"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.328576864535769,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.328576864535769,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.338089802130898,"x1":0.661910197869102,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.338089802130898,"x1":0.661910197869102,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.671423135464231,"x1":1,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.671423135464231,"x1":1,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"}],"xaxis2":{"type":"linear","autorange":false,"range":[0.0055,0.1045],"tickmode":"array","ticktext":["0.025","0.050","0.075","0.100"],"tickvals":[0.025,0.05,0.075,0.1],"categoryorder":"array","categoryarray":["0.025","0.050","0.075","0.100"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.338089802130898,0.661910197869102],"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","scaleanchor":"y","scaleratio":1,"hoverformat":".2f"},"xaxis3":{"type":"linear","autorange":false,"range":[0.0055,0.1045],"tickmode":"array","ticktext":["0.025","0.050","0.075","0.100"],"tickvals":[0.025,0.05,0.075,0.1],"categoryorder":"array","categoryarray":["0.025","0.050","0.075","0.100"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.671423135464231,1],"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","scaleanchor":"y","scaleratio":1,"hoverformat":".2f"},"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"y":0.96395248281826},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"7da7f0eee65":{"x":{},"y":{},"colour":{},"type":"scatter"},"7da2d456a0e":{"intercept":{},"slope":{}}},"cur_data":"7da7f0eee65","visdat":{"7da7f0eee65":["function (y) ","x"],"7da2d456a0e":["function (y) ","x"]},".hideLegend":true,"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="permutation-p-value-as-the-tail-probability-of-a-resampling-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#permutation-p-value-as-the-tail-probability-of-a-resampling-distribution" class="anchor"></a>Permutation p-value as the tail probability of a resampling distribution</h2>
<p>An alternative strategy is to define the p-value by looking at the random variable <span class="math inline">\(B\)</span> instead of the test statistic <span class="math inline">\(T\)</span>. While the p-value is the tail probability of the null distribution, in the context of randomization tests, we can define it as the tail probability of the distribution of <span class="math inline">\(B\)</span>. Given a fixed number <span class="math inline">\(m\)</span> of sampled permutations, recall that the random variable <span class="math inline">\(B\)</span> counts the number of test statistic values larger than or equal to <span class="math inline">\(t_\mathrm{obs}\)</span>. Hence, an alternative equivalent definition of the p-value is given by the so-called <strong>exact permutation p-value</strong>: <span class="math display">\[ p_e = \mathbb{P}_{H_0} \left( B \le b \right), \]</span> where <span class="math inline">\(b\)</span> is the observed number of test statistics larger than or equal to <span class="math inline">\(t_\mathrm{obs}\)</span> (using the observed sample of permutations that was drawn).</p>
<p>Let <span class="math inline">\(B_t\)</span> be a random variable that counts the total number of possible distinct test statistic values exceeding tobs and recall that <span class="math inline">\(m_t\)</span> is the total number of possible distinct permutations. We denote by <span class="math display">\[ p_t = \frac{B_t + 1}{m_t + 1}, \]</span> the permutation p-value when the exhaustive list of all permutations is used.</p>
<p>As we have seen before, it is straightforward to show that <span class="math inline">\(B_t\)</span> follows a discrete uniform distribution on the integers <span class="math inline">\(0, \dots, m_t\)</span> and that, conditional on <span class="math inline">\(B_t = b_t\)</span>, the random variable <span class="math inline">\(B\)</span> follows a binomial distribution of size <span class="math inline">\(m\)</span> and rate of success <span class="math inline">\(p_t\)</span>. We can thus write: <span class="math display">\[ p_e = \sum_{b_t=0}^{B_t} \mathbb{P}_{H_0} \left( B \le b | B_t = b_t \right) \mathbb{P}_{H_0} \left( B_t = b_t \right) = \frac{1}{m_t + 1} \sum_{b_t=0}^{B_t} F_B \left( b; m, \frac{b_t + 1}{m_t + 1} \right), \]</span> where <span class="math inline">\(F_B \left( \cdot; m, \frac{b_t + 1}{m_t + 1} \right)\)</span> is the cumulative probability function of the binomial distribution of size <span class="math inline">\(m\)</span> and probability of success <span class="math inline">\(\frac{b_t + 1}{m_t + 1}\)</span>.</p>
<p>This estimator can be computationally intense to compute for large values of <span class="math inline">\(m_t\)</span>, in which case one might use the following integral approximation: <span class="math display">\[ p_e \approx \frac{b+1}{m+1} - \int_0^{\frac{0.5}{m_t+1}} F_B (b; m, p_t) dp_t. \]</span></p>
</div>
<div id="comparison-by-empirical-evidence" class="section level2">
<h2 class="hasAnchor">
<a href="#comparison-by-empirical-evidence" class="anchor"></a>Comparison by empirical evidence</h2>
<p>In <strong>psi</strong>, you perform a permutation test using the estimator <span class="math inline">\(\widehat{p_\infty}\)</span> of the p-value <span class="math inline">\(p_\infty\)</span> by setting <code>test == "approximate"</code>. This provides a non-exact test but an unbiased estimate of <span class="math inline">\(p_\infty\)</span>. You perform a permutation test using the permutation p-value <span class="math inline">\(p_e\)</span> by setting <code>test == "exact"</code>. This provides an exact test.</p>
<p>The following R code runs simulations to empirically estimate the probability of wrongly rejecting the null hypothesis. The generative model for both samples is the standard normal distribution. Sample sizes are set to <span class="math inline">\(n_1 = n_2 = 10\)</span>. We draw <span class="math inline">\(100\)</span> permutations for each test.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.05</span>
<span class="va">R</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">R</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">seed</span><span class="op">)</span>
<span class="fl">1</span><span class="op">:</span><span class="va">R</span> <span class="op">%&gt;%</span> 
  <span class="fu">map</span><span class="op">(</span><span class="op">~</span> <span class="op">{</span>
    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
    <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
    <span class="va">test_exact</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/two_sample_test.html">two_sample_test</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">x</span>, 
      y <span class="op">=</span> <span class="va">y</span>, 
      statistic <span class="op">=</span> <span class="va">stat_hotelling</span>, 
      test <span class="op">=</span> <span class="st">"exact"</span>, 
      B <span class="op">=</span> <span class="fl">100</span>
    <span class="op">)</span>
    <span class="va">test_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/two_sample_test.html">two_sample_test</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">x</span>, 
      y <span class="op">=</span> <span class="va">y</span>, 
      statistic <span class="op">=</span> <span class="va">stat_hotelling</span>, 
      test <span class="op">=</span> <span class="st">"approximate"</span>, 
      B <span class="op">=</span> <span class="fl">100</span>
    <span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
      approx <span class="op">=</span> <span class="op">(</span><span class="va">test_approx</span><span class="op">$</span><span class="va">pvalue</span> <span class="op">&lt;=</span> <span class="va">alpha</span><span class="op">)</span>, 
      exact <span class="op">=</span> <span class="op">(</span><span class="va">test_exact</span><span class="op">$</span><span class="va">pvalue</span> <span class="op">&lt;=</span> <span class="va">alpha</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">transpose</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">simplify_all</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">map</span><span class="op">(</span><span class="va">mean</span><span class="op">)</span>
<span class="co">#&gt; $approx</span>
<span class="co">#&gt; [1] 0.064</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $exact</span>
<span class="co">#&gt; [1] 0.047</span></code></pre></div>
<p>Note that we only ran <span class="math inline">\(R=1000\)</span> simulations to estimate the probability of wrongly rejecting <span class="math inline">\(H_0\)</span>. Hence, we encourage readers to download the <code>Rmd</code> file for this article and try increasing the <code>R</code> argument in the <code>params</code> list of the YAML header.</p>
<p>This simulation confirms the theoretical value of the probability of wrongly rejecting the null hypothesis for the <em>approximate</em> case. It also provides numerical evidence that using the permutation p-value <span class="math inline">\(p_e\)</span> provides an exact test. This is by design since <span class="math inline">\(p_e\)</span> is a genuine probability hence it is uniformly distributed on <span class="math inline">\((0,1)\)</span> under the null hypothesis.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-phipson2010">
<p>Phipson, Belinda, and Gordon K Smyth. 2010. “Permutation P-Values Should Never Be Zero: Calculating Exact P-Values When Permutations Are Randomly Drawn.” <em>Statistical Applications in Genetics and Molecular Biology</em> 9 (1). <a href="https://doi.org/10.2202/1544-6115.1585">https://doi.org/10.2202/1544-6115.1585</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Alessia Pini, Aymeric Stamm, Simone Vantini.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
