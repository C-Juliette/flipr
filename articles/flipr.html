<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A tour of permutation inference • flipr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="A tour of permutation inference">
<meta property="og:description" content="flipr">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flipr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/flipr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/alternative.html">The alternative hypothesis in permutation testing</a>
    </li>
    <li>
      <a href="../articles/exactness.html">On the exactness of permutation tests</a>
    </li>
    <li>
      <a href="../articles/pvalue-function.html">Calculating p-value functions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/astamm/flipr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="flipr_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>A tour of permutation inference</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/astamm/flipr/blob/master/vignettes/flipr.Rmd"><code>vignettes/flipr.Rmd</code></a></small>
      <div class="hidden name"><code>flipr.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://astamm.github.io/flipr/">flipr</a></span><span class="op">)</span>

<span class="va">generate_grid</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">center_value</span>, <span class="va">min_value</span>, <span class="va">max_value</span>, <span class="va">n</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="va">center_value</span> <span class="op">&gt;</span> <span class="va">min_value</span> <span class="op">&amp;&amp;</span> <span class="va">center_value</span> <span class="op">&lt;</span> <span class="va">max_value</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">min_value</span>, <span class="va">center_value</span>, len <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">]</span>, 
    <span class="va">center_value</span>, 
    <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">center_value</span>, <span class="va">max_value</span>, len <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The permutation framework is perfectly suited for inferential purposes as it allows one to do point estimation, confidence regions and hypothesis tests. In this article, we briefly illustrate how each of these aspects can be treated from a permutation point of view using the <a href="https://astamm.github.io/flipr/"><strong>flipr</strong></a> package.</p>
<div id="toy-example-difference-in-means" class="section level2">
<h2 class="hasAnchor">
<a href="#toy-example-difference-in-means" class="anchor"></a>Toy example: difference in means</h2>
<p>Let us work on a very classic toy example. Suppose that we are interested in studying the difference in means of two populations. We will generate:</p>
<ul>
<li>A first sample of size <span class="math inline">\(n_1 = 10\)</span> observations from a distribution with mean <span class="math inline">\(1\)</span> and unit variance;</li>
<li>A second sample of size <span class="math inline">\(n_2 = 10\)</span> observations from a distribution with mean <span class="math inline">\(4\)</span> and unit variance.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n1</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">n2</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">mu1</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">mu2</span> <span class="op">&lt;-</span> <span class="fl">4</span>
<span class="va">sd1</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">sd2</span> <span class="op">&lt;-</span> <span class="fl">1</span></code></pre></div>
<p>We will consider three different scenari:</p>
<dl>
<dt>Scenario A</dt>
<dd>
<p>Both populations follow Gaussian distributions.</p>
</dd>
</dl>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="va">a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n1</span>, mean <span class="op">=</span> <span class="va">mu1</span>, sd <span class="op">=</span> <span class="va">sd1</span><span class="op">)</span>
<span class="va">a2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n2</span>, mean <span class="op">=</span> <span class="va">mu2</span>, sd <span class="op">=</span> <span class="va">sd2</span><span class="op">)</span></code></pre></div>
<dl>
<dt>Scenario B</dt>
<dd>
<p>Both populations follow Gamma distributions.</p>
</dd>
</dl>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">n1</span>, shape <span class="op">=</span> <span class="fl">1</span>, rate <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">n2</span>, shape <span class="op">=</span> <span class="fl">16</span>, rate <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></code></pre></div>
<dl>
<dt>Scenario C</dt>
<dd>
<p>The first population follows a Gaussian distribution while the second population follows a Gamma distribution.</p>
</dd>
</dl>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="va">c1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n1</span>, mean <span class="op">=</span> <span class="va">mu1</span>, sd <span class="op">=</span> <span class="va">sd1</span><span class="op">)</span>
<span class="va">c2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">n2</span>, shape <span class="op">=</span> <span class="fl">16</span>, rate <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></code></pre></div>
<p>For each scenario, the goal is to make inference on the difference between the means of the two distributions. In other words, the parameter of interest is <span class="math inline">\(\delta = \mu_2 - \mu_1\)</span>.</p>
</div>
<div id="p-value-function" class="section level2">
<h2 class="hasAnchor">
<a href="#p-value-function" class="anchor"></a>P-value function</h2>
<p>The <span class="math inline">\(p\)</span>-value function for the mean difference is a curve that represents the variation of the <span class="math inline">\(p\)</span>-value of a test in which the null hypothesis is <span class="math inline">\(\delta = \delta_0\)</span> as a function of <span class="math inline">\(\delta_0\)</span> <span class="citation">(Martin 2017; Fraser 2019; Infanger and Schmidt-Trucksäss 2019)</span>.</p>
<p>With <a href="https://astamm.github.io/flipr/"><strong>flipr</strong></a>, it is easy to trace such a <span class="math inline">\(p\)</span>-value function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">delta_pe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">a2</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">a1</span><span class="op">)</span>
<span class="va">null_spec</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">parameters</span><span class="op">)</span> <span class="op">{</span><span class="va">y</span> <span class="op">-</span> <span class="va">parameters</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">}</span>
<span class="va">dfa</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>
  delta <span class="op">=</span> <span class="fu">generate_grid</span><span class="op">(</span><span class="va">delta_pe</span>, <span class="va">delta_pe</span> <span class="op">-</span> <span class="fl">2</span>, <span class="va">delta_pe</span> <span class="op">+</span> <span class="fl">2</span>, <span class="fl">20</span><span class="op">)</span>, 
  pvalue <span class="op">=</span> <span class="va">delta</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="../reference/two_sample_pf.html">two_sample_pf</a></span><span class="op">(</span>
      null_specification <span class="op">=</span> <span class="va">null_spec</span>, 
      x <span class="op">=</span> <span class="va">a1</span>, 
      y <span class="op">=</span> <span class="va">a2</span>, 
      statistic <span class="op">=</span> <span class="va">stat_t</span>, 
      B <span class="op">=</span> <span class="fl">10000</span>, 
      seed <span class="op">=</span> <span class="fl">1234</span>, 
      alternative <span class="op">=</span> <span class="st">"two_tail"</span>
    <span class="op">)</span>
<span class="op">)</span>
<span class="va">dfa</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">delta</span>, <span class="va">pvalue</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"P-value function for the mean difference"</span>, 
    subtitle <span class="op">=</span> <span class="st">"Using Student's t-statistic and two-tailed p-values"</span>, 
    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">delta</span><span class="op">)</span>, 
    y <span class="op">=</span> <span class="st">"p-value"</span>
  <span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="flipr_files/figure-html/unnamed-chunk-6-1.png" width="97%"></p>
<p>In the example above, we chose to compute two-tailed <span class="math inline">\(p\)</span>-values (<code>alternative = "two_tail"</code>) using Student’s <span class="math inline">\(t\)</span>-statistic to perform the individual tests (<code>statistic = stat_t</code>) and <span class="math inline">\(10,000\)</span> permutations sampled with replacement (<code>B=10000</code>). We fixed the seed for the generation of the permutations in order to use the same set of sampled permutations for each point of the <span class="math inline">\(p\)</span>-value function.</p>
<p>The first two arguments of the <code><a href="../reference/two_sample_pf.html">flipr::two_sample_pf()</a></code> function are the most important to properly compute the <span class="math inline">\(p\)</span>-value function:</p>
<ul>
<li>
<p>The first argument is <code>parameters</code> and should be a vector or a list of parameters that define the set of null hypotheses of which we want to evaluate the <span class="math inline">\(p\)</span>-value from.</p>
<ul>
<li><p>When one makes inference on a single parameter then <code>parameters</code> is a numerical vector of potential candidates for that parameter.</p></li>
<li><p>When one aims at making inference on multiple parameters at once, then <code>parameters</code> is a list. Each component of that list is in turn a numerical vector whose length matches the number of parameters under investigation.</p></li>
</ul>
</li>
<li><p>The second argument <code>null_specification</code> takes a function of two arguments, namely <code>y</code> and <code>parameters</code> and defines how the second sample <code>y</code> should be transformed given the assumed parameters under the null hypothesis (defined in <code>parameters</code>) in order for samples <code>x</code> and <code>y</code> to be exchangeable under the null hypothesis. This function transforms <code>y</code> for a given null hypothesis. Therefore, <code>parameters</code> should always be a numerical vector whose length matches the number of parameters under investigation.</p></li>
</ul>
<p>The whole setup might seem a bit overwhelming given that one could generate the same <span class="math inline">\(p\)</span>-value function using Student’s parametric <span class="math inline">\(t\)</span>-test as follows:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dfa</span> <span class="op">&lt;-</span> <span class="va">dfa</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    pvalue_alt <span class="op">=</span> <span class="va">delta</span> <span class="op">%&gt;%</span>
      <span class="fu">map_dbl</span><span class="op">(</span><span class="op">~</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span>
          x <span class="op">=</span> <span class="va">a2</span>, 
          y <span class="op">=</span> <span class="va">a1</span>, 
          alternative <span class="op">=</span> <span class="st">"two.sided"</span>, 
          mu <span class="op">=</span> <span class="va">.x</span>, 
          var.equal <span class="op">=</span> <span class="cn">TRUE</span>
        <span class="op">)</span><span class="op">$</span><span class="va">p.value</span>
      <span class="op">}</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span>
    <span class="va">delta</span>, 
    `Parametric Approach` <span class="op">=</span> <span class="va">pvalue_alt</span>, 
    `Permutation Approach` <span class="op">=</span> <span class="va">pvalue</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">delta</span><span class="op">)</span>
<span class="va">dfa</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">delta</span>, <span class="va">value</span>, color <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Scenario A: P-value function for the mean difference"</span>, 
    subtitle <span class="op">=</span> <span class="st">"Using Student's t-statistic and two-tailed p-values"</span>, 
    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">delta</span><span class="op">)</span>, 
    y <span class="op">=</span> <span class="st">"p-value"</span>
  <span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">name</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="flipr_files/figure-html/unnamed-chunk-7-1.png" width="97%"></p>
<p>However, keep in mind that the parametric Student’s <span class="math inline">\(t\)</span>-test is only valid for Gaussian data or for large samples invoking the central limit theorem. When sample sizes are low and samples are not drawn from Gaussian distributions, only the permutation approach is valid. When both samples come from non-Gaussian data (here Gamma-distributed samples) and sample sizes are low (here <span class="math inline">\(10\)</span> for each sample), we get the following <span class="math inline">\(p\)</span>-value functions (cutting below <span class="math inline">\(0.001\)</span> since the usual range of useful <span class="math inline">\(p\)</span>-values is from <span class="math inline">\(0.01\)</span> and above):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">B</span> <span class="op">&lt;-</span> <span class="fl">10000</span>
<span class="va">deltb_pe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b2</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b1</span><span class="op">)</span>
<span class="va">dfb</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>
  delta <span class="op">=</span> <span class="fu">generate_grid</span><span class="op">(</span><span class="va">deltb_pe</span>, <span class="va">deltb_pe</span> <span class="op">-</span> <span class="fl">2</span>, <span class="va">deltb_pe</span> <span class="op">+</span> <span class="fl">2</span>, <span class="fl">20</span><span class="op">)</span>, 
  pvalue <span class="op">=</span> <span class="va">delta</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="../reference/two_sample_pf.html">two_sample_pf</a></span><span class="op">(</span>
      null_specification <span class="op">=</span> <span class="va">null_spec</span>, 
      x <span class="op">=</span> <span class="va">b1</span>, 
      y <span class="op">=</span> <span class="va">b2</span>, 
      statistic <span class="op">=</span> <span class="va">stat_t</span>, 
      B <span class="op">=</span> <span class="va">B</span>, 
      seed <span class="op">=</span> <span class="fl">1234</span>, 
      alternative <span class="op">=</span> <span class="st">"two_tail"</span>
    <span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    pvalue_alt <span class="op">=</span> <span class="va">delta</span> <span class="op">%&gt;%</span>
      <span class="fu">map_dbl</span><span class="op">(</span><span class="op">~</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span>
          x <span class="op">=</span> <span class="va">b2</span>, 
          y <span class="op">=</span> <span class="va">b1</span>, 
          alternative <span class="op">=</span> <span class="st">"two.sided"</span>, 
          mu <span class="op">=</span> <span class="va">.x</span>, 
          var.equal <span class="op">=</span> <span class="cn">TRUE</span>
        <span class="op">)</span><span class="op">$</span><span class="va">p.value</span>
      <span class="op">}</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span>
    <span class="va">delta</span>, 
    Parametric <span class="op">=</span> <span class="va">pvalue_alt</span>, 
    Permutation <span class="op">=</span> <span class="va">pvalue</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">delta</span><span class="op">)</span>
<span class="va">dfb</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">value</span> <span class="op">&gt;</span> <span class="fl">1e-3</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">delta</span>, <span class="va">value</span>, color <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_hline</span><span class="op">(</span>
    yintercept <span class="op">=</span> <span class="fl">0.05</span>, 
    color <span class="op">=</span> <span class="st">"black"</span>, 
    linetype <span class="op">=</span> <span class="st">"dashed"</span>
  <span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Scenario B: P-value function for the mean difference"</span>, 
    subtitle <span class="op">=</span> <span class="st">"Using Student's t-statistic and two-tailed p-values"</span>, 
    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">delta</span><span class="op">)</span>, 
    y <span class="op">=</span> <span class="st">"p-value"</span>, 
    color <span class="op">=</span> <span class="st">"Type of test"</span>
  <span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="flipr_files/figure-html/unnamed-chunk-8-1.png" width="97%"></p>
<p>The parametric <span class="math inline">\(p\)</span>-value function is clearly shifted in the decreasing part on the right of the plot.</p>
<p>When only one of the samples come from non-Gaussian data (here the second sample is Gamma-distributed and sample sizes are low (here <span class="math inline">\(10\)</span> for each sample), we get the following <span class="math inline">\(p\)</span>-value functions (cutting below <span class="math inline">\(0.001\)</span> since the usual range of useful <span class="math inline">\(p\)</span>-values is from <span class="math inline">\(0.01\)</span> and above):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">deltc_pe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">c2</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">c1</span><span class="op">)</span>
<span class="va">dfc</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>
  delta <span class="op">=</span> <span class="fu">generate_grid</span><span class="op">(</span><span class="va">deltc_pe</span>, <span class="va">deltc_pe</span> <span class="op">-</span> <span class="fl">2</span>, <span class="va">deltc_pe</span> <span class="op">+</span> <span class="fl">2</span>, <span class="fl">20</span><span class="op">)</span>, 
  pvalue <span class="op">=</span> <span class="va">delta</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="../reference/two_sample_pf.html">two_sample_pf</a></span><span class="op">(</span>
      null_specification <span class="op">=</span> <span class="va">null_spec</span>, 
      x <span class="op">=</span> <span class="va">c1</span>, 
      y <span class="op">=</span> <span class="va">c2</span>, 
      statistic <span class="op">=</span> <span class="va">stat_t</span>, 
      B <span class="op">=</span> <span class="va">B</span>, 
      seed <span class="op">=</span> <span class="fl">1234</span>, 
      alternative <span class="op">=</span> <span class="st">"two_tail"</span>
    <span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    pvalue_alt <span class="op">=</span> <span class="va">delta</span> <span class="op">%&gt;%</span>
      <span class="fu">map_dbl</span><span class="op">(</span><span class="op">~</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span>
          x <span class="op">=</span> <span class="va">c2</span>, 
          y <span class="op">=</span> <span class="va">c1</span>, 
          alternative <span class="op">=</span> <span class="st">"two.sided"</span>, 
          mu <span class="op">=</span> <span class="va">.x</span>, 
          var.equal <span class="op">=</span> <span class="cn">TRUE</span>
        <span class="op">)</span><span class="op">$</span><span class="va">p.value</span>
      <span class="op">}</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span>
    <span class="va">delta</span>, 
    Parametric <span class="op">=</span> <span class="va">pvalue_alt</span>, 
    Permutation <span class="op">=</span> <span class="va">pvalue</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">delta</span><span class="op">)</span>
<span class="va">dfc</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">value</span> <span class="op">&gt;</span> <span class="fl">1e-3</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">delta</span>, <span class="va">value</span>, color <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_hline</span><span class="op">(</span>
    yintercept <span class="op">=</span> <span class="fl">0.05</span>, 
    color <span class="op">=</span> <span class="st">"black"</span>, 
    linetype <span class="op">=</span> <span class="st">"dashed"</span>
  <span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Scenario C: P-value function for the mean difference"</span>, 
    subtitle <span class="op">=</span> <span class="st">"Using Student's t-statistic and two-tailed p-values"</span>, 
    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">delta</span><span class="op">)</span>, 
    y <span class="op">=</span> <span class="st">"p-value"</span>, 
    color <span class="op">=</span> <span class="st">"Type of test"</span>
  <span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="flipr_files/figure-html/unnamed-chunk-9-1.png" width="97%"></p>
<p>The situation seems less critical here when only one sample is non-Gaussian but this is only one simulation using a Gamma-distributed second sample. The bias could be more important for other distributions.</p>
<p>Another issue with the parametric approach is that it is very limited in the type of data that one can use. The parametric <span class="math inline">\(t\)</span>-test for instance is only meant for real-valued data. It will not be applicable to multivariate data or functional data or topological data or network-valued data or any other type of data that is not representable as real-valued data. This further motivates inference via permutation.</p>
<p>Getting access to the <span class="math inline">\(p\)</span>-value function is key to making inference as point estimation, confidence regions and hypothesis tests all come as a by-product as we will show in the next sections.</p>
</div>
<div id="point-estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#point-estimation" class="anchor"></a>Point estimation</h2>
<p>One can obtain a point estimate of the parameter under investigation by searching which value of the parameter reaches the maximum of the <span class="math inline">\(p\)</span>-value function (which is <span class="math inline">\(1\)</span>). One can use the <code><a href="https://rdrr.io/r/stats/optimize.html">optimise()</a></code> function to solve the one-dimensional optimization problem:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/optimize.html">optimise</a></span><span class="op">(</span>
  f <span class="op">=</span> <span class="va">two_sample_pf</span>, 
  interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span>, 
  null_specification <span class="op">=</span> <span class="va">null_spec</span>, 
  x <span class="op">=</span> <span class="va">a1</span>, 
  y <span class="op">=</span> <span class="va">a2</span>, 
  statistic <span class="op">=</span> <span class="va">stat_t</span>, 
  B <span class="op">=</span> <span class="fl">10000</span>, 
  seed <span class="op">=</span> <span class="fl">1234</span>, 
  alternative <span class="op">=</span> <span class="st">"two_tail"</span>, 
  maximum <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>
<span class="co">#&gt; $maximum</span>
<span class="co">#&gt; [1] 3.269156</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $objective</span>
<span class="co">#&gt; [1] 0.9999946</span></code></pre></div>
</div>
<div id="confidence-intervals" class="section level2">
<h2 class="hasAnchor">
<a href="#confidence-intervals" class="anchor"></a>Confidence intervals</h2>
<p>One can obtain a confidence interval for the parameter under investigation by searching for which values of the parameter the <span class="math inline">\(p\)</span>-value function remains above a pre-specified significance level <span class="math inline">\(\alpha\)</span>. The <a href="https://astamm.github.io/flipr/"><strong>flipr</strong></a> package has a built-in generic function to do just that:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/two_sample_ci.html">two_sample_ci</a></span><span class="op">(</span>
  point_estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">a2</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">a1</span><span class="op">)</span>, 
  alpha <span class="op">=</span> <span class="fl">0.05</span>, 
  null_specification <span class="op">=</span> <span class="va">null_spec</span>, 
  x <span class="op">=</span> <span class="va">a1</span>, 
  y <span class="op">=</span> <span class="va">a2</span>, 
  statistic <span class="op">=</span> <span class="va">stat_t</span>, 
  B <span class="op">=</span> <span class="fl">10000</span>, 
  alternative <span class="op">=</span> <span class="st">"two_tail"</span>
<span class="op">)</span>
<span class="co">#&gt; ℹ Setting the seed for sampling permutations is mandatory for obtaining a continuous p-value function. Using `seed = 1234`.</span>
<span class="co">#&gt; [1] 2.324629 4.253882</span></code></pre></div>
</div>
<div id="hypothesis-tests" class="section level2">
<h2 class="hasAnchor">
<a href="#hypothesis-tests" class="anchor"></a>Hypothesis tests</h2>
<p>Extracting the <span class="math inline">\(p\)</span>-value for a single hypothesis test in which the null hypothesis is <span class="math inline">\(H_0: \delta = \delta_0\)</span> is immediate from the <span class="math inline">\(p\)</span>-value function as it boils down to evaluating the <span class="math inline">\(p\)</span>-value function in <span class="math inline">\(\delta_0\)</span>. Hence we can for instance test <span class="math inline">\(H_0: \delta = 3\)</span> against the alternative <span class="math inline">\(H_1: \delta \ne 3\)</span> using the following piece of code:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/two_sample_pf.html">two_sample_pf</a></span><span class="op">(</span>
  parameters <span class="op">=</span> <span class="fl">3</span>, 
  null_specification <span class="op">=</span> <span class="va">null_spec</span>, 
  x <span class="op">=</span> <span class="va">a1</span>, 
  y <span class="op">=</span> <span class="va">a2</span>, 
  statistic <span class="op">=</span> <span class="va">stat_t</span>, 
  B <span class="op">=</span> <span class="fl">10000</span>, 
  seed <span class="op">=</span> <span class="fl">1234</span>, 
  alternative <span class="op">=</span> <span class="st">"two_tail"</span>
  <span class="op">)</span>
<span class="co">#&gt; [1] 0.5826363</span></code></pre></div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-fraser2019">
<p>Fraser, D. A. S. 2019. “The P-Value Function and Statistical Inference.” <em>The American Statistician</em> 73 (sup1): 135–47. <a href="https://doi.org/10.1080/00031305.2018.1556735">https://doi.org/10.1080/00031305.2018.1556735</a>.</p>
</div>
<div id="ref-infanger2019">
<p>Infanger, Denis, and Arno Schmidt-Trucksäss. 2019. “P Value Functions: An Underused Method to Present Research Results and to Promote Quantitative Reasoning.” <em>Statistics in Medicine</em> 38 (21): 4189–97. <a href="https://doi.org/10.1002/sim.8293">https://doi.org/10.1002/sim.8293</a>.</p>
</div>
<div id="ref-martin2017">
<p>Martin, Ryan. 2017. “A Statistical Inference Course Based on P-Values.” <em>The American Statistician</em> 71 (2): 128–36. <a href="https://doi.org/10.1080/00031305.2016.1208629">https://doi.org/10.1080/00031305.2016.1208629</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Alessia Pini, Aymeric Stamm, Simone Vantini.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
