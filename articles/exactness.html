<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>On the exactness of permutation tests • psi</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="On the exactness of permutation tests">
<meta property="og:description" content="psi">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">psi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/alternative.html">The alternative hypothesis in permutation testing</a>
    </li>
    <li>
      <a href="../articles/exactness.html">On the exactness of permutation tests</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="exactness_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>On the exactness of permutation tests</h1>
            
      
      
      <div class="hidden name"><code>exactness.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">psi</span><span class="op">)</span></code></pre></div>
<p>In this article, we discuss the exactness property of permutation tests, which is closely related to how <span class="math inline">\(p\)</span>-values are estimated from the permutations.</p>
<div id="exactness-of-a-test" class="section level2">
<h2 class="hasAnchor">
<a href="#exactness-of-a-test" class="anchor"></a>Exactness of a test</h2>
<p>When you want to perform an hypothesis test, you first need to specify the <strong>null hypothesis</strong> <span class="math inline">\(H_0\)</span> you are testing and the <strong>alternative hypothesis</strong> <span class="math inline">\(H_a\)</span> you are testing against. Next, you need to define a <strong>statistic</strong> <span class="math inline">\(T\)</span> that fulfills the following properties:</p>
<ul>
<li>you can compute its observed value under the null hypothesis once you observed some data;</li>
<li>large values of the statistic are evidence in favor of the alternative hypothesis;</li>
<li>you know (an approximation of) the distribution of <span class="math inline">\(T\)</span> under the null hypothesis, also known as the <strong>null distribution</strong>.</li>
</ul>
<p>Finally, you specify a significance level <span class="math inline">\(\alpha\)</span> which controls the probability of making type I errors: <span class="math display">\[  \mathbb{P} \left( \mbox{Type I errors} \right) = \mathbb{P} \left( \mbox{Reject } H_0 \mbox{ while it was true} \right) = \alpha. \]</span> This control is exact (i.e. the equality holds) if you know the null distribution. When you estimate it, as it is done in resampling-based testing procedures, you are not guaranteed to get this control.</p>
<p>Permutation tests use permutations of the data to estimate the null distribution and therefore access an estimate of the <span class="math inline">\(p\)</span>-value. There are several ways of estimating <span class="math inline">\(p\)</span>-values from a permutation scheme. In this article, we first review the traditional approach to permutation testing and show that it does not lead to an exact testing procedure. Next, we demonstrate that we can make the permutation test exact by estimating the <span class="math inline">\(p\)</span>-value in a different fashion.</p>
</div>
<div id="monte-carlo-estimator-of-the-p-value" class="section level2">
<h2 class="hasAnchor">
<a href="#monte-carlo-estimator-of-the-p-value" class="anchor"></a>Monte-Carlo estimator of the p-value</h2>
<p>Let us state again the two-sample testing problem for the sake of clarity.</p>
<p>We start with two samples <span class="math inline">\(X_1, \dots, X_{n_x} \stackrel{iid}{\sim} \mathcal{D}(\theta_x)\)</span> and <span class="math inline">\(Y_1, \dots, Y_{n_y} \stackrel{iid}{\sim} \mathcal{D}(\theta_y)\)</span>. We want to know whether the two distributions are the same or not on the basis of the two samples we collected. In this parametric setting, it boils down to testing the following hypotheses: <span class="math display">\[ H_0: \theta_x = \theta_y \quad \mbox{vs} \quad \theta_x \neq \theta_y. \]</span> Let <span class="math inline">\(T\)</span> be a statistic that depends on the two samples which is suited for elucidating this test, i.e.:</p>
<ul>
<li>you can compute its observed value under the null hypothesis once you observed some data;</li>
<li>large values of the statistic are evidence in favor of the alternative hypothesis.</li>
</ul>
<p>Now, for performing the test, one should also know (an approximation of) the distribution of <span class="math inline">\(T\)</span> under the null hypothesis, also known as the <strong>null distribution</strong>, from which the p-value associated to this test can be computed for instance.</p>
<p>If one knows the exact null distribution, then there is no need to resort to permutations. However, if the null distribution is not known, permutations come in handy for approaching it.</p>
<p>The idea is that, under the null hypothesis, the two samples come from the same distribution. Hence, we can pull them together as one big sample of size <span class="math inline">\(n = n_x + n_y\)</span> generated by that common distribution. At this point, we can split the pooled sample into two random subsets of size <span class="math inline">\(n_x\)</span> and <span class="math inline">\(n_y\)</span> respectively, and use them to compute a value of the statistic <span class="math inline">\(T\)</span>. If we repeat many times this splitting strategy, say <span class="math inline">\(B\)</span> times, we end up with <span class="math inline">\(B\)</span> values of the statistic from which we can compute the empirical distribution, known as the <strong>permutation distribution</strong>, which approaches the null distribution.</p>
<p>Following this description, if we denote <span class="math inline">\(t_\mathrm{obs}\)</span> the value of the statistic computed from the original two samples and <span class="math inline">\(t_b^\star\)</span> the value of the statistic computed from the two samples generated at the <span class="math inline">\(b\)</span>-<em>th</em> split of the pooled sample, we deduce that an estimate of the p-value can be obtained by: <span class="math display">\[ \widehat{p}_\mathrm{MC} = \frac{1}{B} \sum_{b=1}^B \mathbb{I}_{[t_\mathrm{obs},+\infty)}(t_b^\star). \]</span></p>
<p>However, when one uses this estimator of the p-value for the purpose of hypothesis testing, the resulting test is not exact. Let us provide some empirical evidence by running simulations. In <strong>psi</strong>, you perform a permutation test using this estimator of the p-value by setting the optional argument <code>test</code> to <code>"approximate"</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.05</span>
<span class="va">B</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="fl">1</span><span class="op">:</span><span class="va">B</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_lgl</a></span><span class="op">(</span><span class="op">~</span> <span class="op">{</span>
    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
    <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
    <span class="va">test_hotelling</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/two_sample_test.html">two_sample_test</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">x</span>, 
      y <span class="op">=</span> <span class="va">y</span>, 
      statistic <span class="op">=</span> <span class="va">stat_hotelling</span>, 
      test <span class="op">=</span> <span class="st">"exact"</span>
    <span class="op">)</span>
    <span class="va">test_hotelling</span><span class="op">$</span><span class="va">pvalue</span> <span class="op">&lt;</span> <span class="va">alpha</span>
  <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.05</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="fl">1</span><span class="op">:</span><span class="va">B</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_lgl</a></span><span class="op">(</span><span class="op">~</span> <span class="op">{</span>
    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
    <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
    <span class="va">test_hotelling</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/two_sample_test.html">two_sample_test</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">x</span>, 
      y <span class="op">=</span> <span class="va">y</span>, 
      statistic <span class="op">=</span> <span class="va">stat_hotelling</span>, 
      test <span class="op">=</span> <span class="st">"approximate"</span>
    <span class="op">)</span>
    <span class="va">test_hotelling</span><span class="op">$</span><span class="va">pvalue</span> <span class="op">&lt;</span> <span class="va">alpha</span>
  <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.04</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Alessia Pini, Aymeric Stamm, Simone Vantini.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
